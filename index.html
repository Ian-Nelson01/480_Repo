<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>STOCKS, HOMEPAGE</title>
    <script type="module" src="./modules/data_control.js"></script>
    <link rel="stylesheet" href="./home-view.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=rocket_launch" />
  </head>

<!-- Page heading with decorative line-->
  <header>
    <h2>Nathan's Stocks</h2>
    <hr width="100%" size="2" color="#0196b1" noshade />
  </header>
  
<!--search bar-->
  <body>
    <div class="SearchDiv">
      <input
        class="search_field"
        type="text"
        placeholder="Search.."
        name="search"
      />
      
      <!-- script for dropdown box that decends from search bar-->
      <script>
      

/***********************
 *   SEARCH DROPDOWN    *
 ***********************/
// Function to toggle the dropdown menu from the searchbar
function toggleDropdown() {
    
  //uses the change in dropdown toggle to sneakily reset the rocket animation
  const searchSuggest = document.getElementById("myResult");
  searchSuggest.style.animationPlayState = "paused";

// check if the dropdown box is visible or not via the display property.
// set visibility to opposite of current visibility.
  const dropdownContent = document.getElementById("myDropdown")
  if (dropdownContent.style.display === "block") {
    dropdownContent.style.display = "none"
  } else {
    dropdownContent.style.display = "block"
  }
}

// temp event listner for temp add stock button. Im scared to delete it.
document.addEventListener('DOMContentLoaded', function () {
  const addButton = document.getElementById("addElementBtn")
  const container = document.getElementById("container")
  // Add event listener to the 'Add Element' button
  addButton.addEventListener("click", addListItem)
});



// Event listener to close the dropdown if clicking outside 
// i dont like it staying open
window.onclick = function (event) {

    // get elements
  const dropdownContent = document.getElementById("myDropdown")
  const submitButton = document.querySelector(".submit_button")

  // Check if the click was outside the dropdown and the submit button
  if (
    !submitButton.contains(event.target) &&
      !dropdownContent.contains(event.target)
  ) {
      // hide dropdown
    dropdownContent.style.display = "none"
  }
}

      </script>
      <!--button to display dropdown box, looks like magnifying glass-->
      <button onclick="toggleDropdown()" class="submit_button" type="submit">
        ðŸ”Žï¸Ž
        <i class="fa fa-search"></i>
      </button>
    </div>
    
    <!-- spot where dropdown drops down -->
    <div id="myDropdown" class="dropdown-content">
    <!--preview row displaying stock user searched for-->
      <div id="myResult" class="search-suggest">
      <!-- button to add previes to stock list. its a rocket ship!-->
        <span id="rocket" class="material-symbols-outlined">
          rocket_launch
        </span>
        <!-- Stock symbol in preview -->
        <div class = "suggest-symbol">
          DGI
        </div>
         <!-- stock info in preview -->
        <div class = "stonk">
          75.59 +0.82(+1.19%)
        </div>
      </div>
    </div>
    
     <!-- temp button link to details page. need to apply to stocks -->
    <form action="details-view.html">
        <input type="submit" value="Go to Another Page">
    </form>
    
     <!-- blue box the list is in -->
      <!-- this is not actually the lists container, just a decoration -->
    <div class="mainBlock">

      <!-- list container, utilizes dropdown library for fun moving around -->
      <div id="container"  class="list js-list">

         <!-- Temporary stocks to populate page -->
        <div class="list__item is-idle js-item">
          <!-- stock symbol -->
          <div class = "symbol">DGI</div>
          <!-- stock info -->
          <div class = "stonk">
            75.59 +0.82(+1.19%)
          </div>
          <!-- js script for mini chart -->
          <script
            type="text/javascript"
            src="https://www.gstatic.com/charts/loader.js"
          ></script>
          <!-- mini chart -->
          <div
            class="chart"
            id="chart_div2"
            style="width: 25%; height: 50px"
          ></div>
          <!-- drag and drop handle     6 dots -->
          <div class="drag-handle js-drag-handle"></div>
        </div>
        
         <!-- Temporary stocks to populate page -->
        <div class="list__item is-idle js-item">
         <!-- stock symbol -->
          <div class="symbol">ABSS</div>
          <!--  stock info -->
          <div class="stonk">24.92 +0.72(+2.33%)</div>
          <!-- mini chart script-->
          <script
            type="text/javascript"
            src="https://www.gstatic.com/charts/loader.js"
          ></script>
          <!-- mini chart -->
          <div
            class="chart"
            id="chart_div3"
            style="width: 25%; height: 50px"
          ></div>
          <!-- drag and drop handle -->
          <div class="drag-handle js-drag-handle"></div>
        </div>
        
        <!--temporary stock to populate page  -->
        <div class="list__item is-idle js-item">
          <!-- stock symbol -->
          <div class="symbol">ABSE</div>
          <!-- stock info -->
          <div class="stonk">24.92 +0.72(+2.33%)</div>
          <!-- mini chart script -->
          <script
            type="text/javascript"
            src="https://www.gstatic.com/charts/loader.js"
          ></script>
          <!-- mini chart -->
          <div
            class="chart"
            id="chart_div5"
            style="width: 25%; height: 50px"
          ></div>
          <!-- drag and drop handle -->
          <div class="drag-handle js-drag-handle"></div>

        </div>
      </div>
    </div>
    
    <!-- grow box is a second blue rectangle hidden under the 1st one -->
    <!-- it grows and shrinks to fake list container expanding animation -->
    <div id = "growBox"class="growBox">
    

      
      <!-- I'm testing things here --Connor  -->
      <script type="module" defer>
       import {permissions_test } from "./modules/local-store.js"
       import {fillAllRows, updateStonkBySymbol} from "./modules/home_control.js"
       import {query_endpoint,
               query_intraday,
               query_daily,
               query_monthly
       } from "./modules/interface.js"

       permissions_test()

       const testData = [
         { symbol: "DGI", stonk: "05.59 +0.82(+1.19%)" },
         { symbol: "Stk2", stonk: "04.92 +0.72(+2.33%)" },
         { symbol: "Stk3", stonk: "04.92 +0.72(+2.33%)" },
         { symbol: "Stk4", stonk: "011.02 -1.50(-0.71%)" }, // Example new data
       ];

       fillAllRows(testData)

       updateStonkBySymbol("DGI", "no money");

       //var stocks = ["DHC","DFS", "CBLL"]
       //query_realtime(stocks)

       //const apple = query_intraday("AAPL", 2)
       //console.log(apple)

       // I hate promises
       query_intraday("AAPL", 3).then((result) => {
         console.log(result); // Logs the resolved object
       }).catch((error) => {
         console.error("Error:", error);
       });

        query_daily("IBM").then((result) => {
         console.log(result); // Logs the resolved object
       }).catch((error) => {
         console.error("Error:", error);
       });

       query_monthly("DFS").then((result) => {
         console.log(result); // Logs the resolved object
       }).catch((error) => {
         console.error("Error:", error);
       });


      </script>

      <!-- call js from file -->
      <script type="module" src="./home-view.js"></script>
  </body>
</html>
